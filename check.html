<!DOCTYPE html>
<html>
<head>
	<title>视频列表</title>
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=0" />
	<meta charset='UTF-8'> 
	<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
	<script src="https://fdk.c0v0c.com/data.js?t=1590053403"></script>
</head>
<body>
	<div id='result'>
		<div>Result</div>
	</div>
	<script type="text/javascript">
		window.onload = checkJob;

		function checkJob(){
			if(data.length < 0){
				$('#result').append('<div>无数据</div>');
				return;
			}
			check(0);
		}

		function check(i){
			console.log(i);
			if(i >= data.length){
				checkFinish();
				return;
			}
			var current = data[i];
			var title = current.name;

			//获取所有要检查的链接
			var url = [];
			for(j in current.urls){
				url.push(current.urls[j].url);
			};
			if(current.url){
				url.push(current.url);
			}

			console.log(url);

			var urlLenght = url.length;
			var urlCount = 0;
			if(urlLenght < 1){
				check(++i);
			}
			for(j in url){
				//请求
				$.ajax({
					url: url[j]
				})
					.then((response) => {
						if(/啊叻？视频不见了？/.test(response)){
							printErrorUrl(title, url[j], '啊叻？视频不见了？');
						}

						urlCount++;
						if(urlCount >= urlLenght){
							setTimeout(() => {
								check(++i);
							}, 200);
						}
					})
					.catch(function(error){
						printErrorUrl(title, url[j], '请求失败');

						urlCount++;
						if(urlCount >= urlLenght){
							setTimeout(() => {
								check(++i);
							}, 200);
						}
					});
			}
		}

		function printErrorUrl(title, url, msg){
			$('#result').append('<div>'+title+' '+url+' '+msg+'</div>');
		}

		function checkFinish(){
			$('#result').append('<div>检查结束</div>');
		}
	</script>
</body>